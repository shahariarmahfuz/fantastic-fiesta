{% extends 'base.html' %}

{% block title %}рж╣рзЛржо - ржлрж╛ржЗрж▓ рж╕рж╛рж░рзНржнрж╛рж░{% endblock %}

{% block content %}
    {# ржЖржкрж▓рзЛржб ржПржмржВ ржлрзЛрж▓рзНржбрж╛рж░ рждрзИрж░рж┐рж░ рж╕рзЗржХрж╢ржи #}
    <div class="row upload-section">
        <div class="col-md-6 mb-3 mb-md-0">
             <h3>ржлрж╛ржЗрж▓ ржЖржкрж▓рзЛржб ржХрж░рзБржи</h3>
            <form method="post" action="{{ url_for('upload_file') }}" enctype="multipart/form-data" class="p-3 border rounded bg-light">
                 <div class="form-group">
                    <label for="file_upload">ржлрж╛ржЗрж▓ ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржи</label>
                    {# Removed accept attribute to allow any file #}
                    <input type="file" class="form-control-file" name="file_upload" id="file_upload" required>
                </div>
                <div class="form-group">
                    <label for="folder_id">ржХрзЛржи ржлрзЛрж▓рзНржбрж╛рж░рзЗ рж░рж╛ржЦржмрзЗржи?</label>
                    <select name="folder_id" id="folder_id" class="form-control">
                        <option value="root">-- ржорзВрж▓ ржлрзЛрж▓рзНржбрж╛рж░ (рж░рзБржЯ) --</option>
                        {% for f in folders %} {# folders variable passed from route #}
                        <option value="{{ f.id }}">{{ f.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <button type="submit" class="btn btn-success">ржЖржкрж▓рзЛржб</button>
            </form>
        </div>
        <div class="col-md-6">
             <h3>ржирждрзБржи ржлрзЛрж▓рзНржбрж╛рж░ рждрзИрж░рж┐ ржХрж░рзБржи</h3>
            <form method="post" action="{{ url_for('create_folder') }}" class="p-3 border rounded bg-light">
                  <div class="form-group">
                     <label for="folder_name">ржлрзЛрж▓рзНржбрж╛рж░рзЗрж░ ржирж╛ржо</label>
                    <input type="text" class="form-control" name="folder_name" id="folder_name" placeholder="ржирждрзБржи ржлрзЛрж▓рзНржбрж╛рж░рзЗрж░ ржирж╛ржо ржжрж┐ржи" required>
                </div>
                <button type="submit" class="btn btn-secondary">рждрзИрж░рж┐ ржХрж░рзБржи</button>
            </form>
        </div>
    </div>
    <hr>

    {# ржлрзЛрж▓рзНржбрж╛рж░ рж▓рж┐рж╕рзНржЯ #}
    <h3>ЁЯУБ ржЖржкржирж╛рж░ ржлрзЛрж▓рзНржбрж╛рж░рж╕ржорзВрж╣</h3>
    {% if folders %}
        <div class="list-group mb-4">
            {% for f in folders %}
                <a href="{{ url_for('view_folder', folder_id=f.id) }}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                    <span>{{ f.name }}</span>
                    {# Optional: Add folder actions like rename/delete later #}
                     <small class="text-muted"></small> {# Placeholder for potential actions/info #}
                </a>
            {% endfor %}
        </div>
    {% else %}
        <p>ржХрзЛржирзЛ ржлрзЛрж▓рзНржбрж╛рж░ рждрзИрж░рж┐ ржХрж░рж╛ рж╣ржпрж╝ржирж┐ред</p>
    {% endif %}
    <hr>

    {# рж░рзБржЯрзЗрж░ ржлрж╛ржЗрж▓ржЧрзБрж▓рзЛ #}
    <h3>ЁЯУД ржорзВрж▓ ржлрзЛрж▓рзНржбрж╛рж░рзЗрж░ ржлрж╛ржЗрж▓рж╕ржорзВрж╣ (рж░рзБржЯ)</h3>
     {% if root_files %}
        <ul class="list-group">
            {% for file in root_files %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <div class="file-item">
                     <span class="file-icon">ЁЯУД</span> {# Generic icon, enhance later maybe #}
                     <div class="d-flex flex-column">
                         <a href="{{ url_for('view_file', file_id=file.id) }}" title="ржлрж╛ржЗрж▓ ржжрзЗржЦрзБржи">{{ file.original_filename }}</a>
                         <small class="text-muted">ржЖржкрж▓рзЛржб: {{ file.upload_time | datetimeformat }}</small>
                     </div>
                </div>

                <div class="file-actions">
                    <div class="dropdown">
                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="dropdownMenuButton{{ file.id }}" data-toggle="dropdown" aria-expanded="false" title="ржЕржкрж╢ржи">
                            тЛо
                        </button>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton{{ file.id }}">
                            <a class="dropdown-item" href="{{ url_for('view_file', file_id=file.id) }}">ржжрзЗржЦрзБржи</a>
                            <a class="dropdown-item" href="{{ url_for('download_file', file_id=file.id) }}">ржбрж╛ржЙржирж▓рзЛржб</a>
                            <div class="dropdown-divider"></div>
                            {# Share Button Form #}
                            <form method="post" action="{{ url_for('create_share_link', file_id=file.id) }}" class="dropdown-item p-0">
                                 <button type="submit" class="btn btn-link text-decoration-none text-body w-100 text-left pl-3">рж╢рзЗржпрж╝рж╛рж░</button>
                             </form>
                             {# Move Button Trigger #}
                            <button type="button" class="dropdown-item" data-toggle="modal" data-target="#moveModal{{ file.id }}">ржорзБржн</button>
                            <div class="dropdown-divider"></div>
                             {# Delete Button Form #}
                             <form method="post" action="{{ url_for('delete_file', file_id=file.id) }}" class="dropdown-item p-0" onsubmit="return confirm('ржЖржкржирж┐ ржХрж┐ ржирж┐рж╢рзНржЪрж┐рждржнрж╛ржмрзЗ ржПржЗ ржлрж╛ржЗрж▓ржЯрж┐ ржЯрзНрж░рзНржпрж╛рж╢рзЗ ржкрж╛ржарж╛рждрзЗ ржЪрж╛ржи?');">
                                <button type="submit" class="btn btn-link text-danger text-decoration-none w-100 text-left pl-3">ржбрж┐рж▓рж┐ржЯ (ржЯрзНрж░рзНржпрж╛рж╢)</button>
                            </form>
                        </div>
                    </div>
                </div>{# /file-actions #}
            </li>

             {# --- Move Modal for this file --- #}
            <div class="modal fade" id="moveModal{{ file.id }}" tabindex="-1" aria-labelledby="moveModalLabel{{ file.id }}" aria-hidden="true">
              <div class="modal-dialog modal-sm">
                <div class="modal-content">
                  <form method="post" action="{{ url_for('move_file', file_id=file.id) }}">
                    <div class="modal-header">
                      <h5 class="modal-title" id="moveModalLabel{{ file.id }}">ржлрж╛ржЗрж▓ ржорзБржн ржХрж░рзБржи</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    </div>
                    <div class="modal-body">
                      <p><small>ржлрж╛ржЗрж▓: {{ file.original_filename | truncate(40)}}</small></p>
                      <div class="form-group">
                          <label for="target_folder_id{{ file.id }}">ржХрзЛржерж╛рзЯ ржорзБржн ржХрж░ржмрзЗржи?</label>
                          <select name="target_folder_id" id="target_folder_id{{ file.id }}" class="form-control" required>
                              {# Root option is not needed here as file is already in root #}
                              {% for f in folders %}
                                   {# Cannot move to itself (which is root, represented by None) #}
                                   {# All folders are valid targets #}
                                   <option value="{{ f.id }}">{{ f.name }}</option>
                              {% else %}
                                <option value="" disabled>ржХрзЛржирзЛ ржлрзЛрж▓рзНржбрж╛рж░ ржирзЗржЗ</option>
                              {% endfor %}
                          </select>
                      </div>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">ржмрж╛рждрж┐рж▓</button>
                      <button type="submit" class="btn btn-primary btn-sm" {% if not folders %}disabled{% endif %}>ржорзБржн ржХрж░рзБржи</button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
            {# --- End Move Modal --- #}

            {% endfor %}
        </ul>{# /list-group #}
    {% else %}
        <p>ржорзВрж▓ ржлрзЛрж▓рзНржбрж╛рж░рзЗ (рж░рзБржЯрзЗ) ржХрзЛржирзЛ ржлрж╛ржЗрж▓ ржЖржкрж▓рзЛржб ржХрж░рж╛ рж╣ржпрж╝ржирж┐ред</p>
    {% endif %}

{% endblock %}
