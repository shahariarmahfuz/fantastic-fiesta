{% extends 'base.html' %}

{% block title %}ржлрзЛрж▓рзНржбрж╛рж░: {{ folder.name }}{% endblock %}

{% block content %}
    {# ржлрзЛрж▓рзНржбрж╛рж░рзЗрж░ ржирж╛ржо ржПржмржВ ржлрж┐рж░рзЗ ржпрж╛ржУрзЯрж╛рж░ рж▓рж┐ржЩрзНржХ #}
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h2 class="mb-0">ЁЯУБ {{ folder.name }}</h2>
      <a href="{{ url_for('home') }}" class="btn btn-sm btn-outline-secondary">&leftarrow; рж╣рзЛржо ржкрзЗржЬрзЗ ржлрж┐рж░рзЗ ржпрж╛ржи</a>
    </div>
    <hr>

    {# ржПржЗ ржлрзЛрж▓рзНржбрж╛рж░рзЗ ржлрж╛ржЗрж▓ ржЖржкрж▓рзЛржб ржХрж░рж╛рж░ ржлрж░рзНржо #}
    <div class="card mb-4 upload-section">
        <div class="card-header">ржПржЗ ржлрзЛрж▓рзНржбрж╛рж░рзЗ ржлрж╛ржЗрж▓ ржЖржкрж▓рзЛржб ржХрж░рзБржи</div>
        <div class="card-body">
             <form method="post" action="{{ url_for('upload_file') }}" enctype="multipart/form-data">
                 <div class="form-group">
                    <label for="file_upload">ржлрж╛ржЗрж▓ ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржи</label>
                    <input type="file" class="form-control-file" name="file_upload" id="file_upload" required>
                </div>
                <input type="hidden" name="folder_id" value="{{ folder.id }}"> {# Current folder ID #}
                <button type="submit" class="btn btn-success">ржЖржкрж▓рзЛржб</button>
            </form>
        </div>
    </div>
    <hr>

    {# ржлрзЛрж▓рзНржбрж╛рж░рзЗрж░ ржнрж┐рждрж░рзЗрж░ ржлрж╛ржЗрж▓ржЧрзБрж▓рзЛ #}
    <h3>ЁЯУД ржлрзЛрж▓рзНржбрж╛рж░рзЗрж░ ржлрж╛ржЗрж▓рж╕ржорзВрж╣</h3>
     {% if files %} {# 'files' variable passed from route #}
        <ul class="list-group">
            {% for file in files %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <div class="file-item">
                     <span class="file-icon">ЁЯУД</span> {# Generic icon #}
                     <div class="d-flex flex-column">
                         <a href="{{ url_for('view_file', file_id=file.id) }}" title="ржлрж╛ржЗрж▓ ржжрзЗржЦрзБржи">{{ file.original_filename }}</a>
                         <small class="text-muted">ржЖржкрж▓рзЛржб: {{ file.upload_time | datetimeformat }}</small>
                     </div>
                </div>

                <div class="file-actions">
                    <div class="dropdown">
                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="dropdownMenuButton{{ file.id }}" data-toggle="dropdown" aria-expanded="false" title="ржЕржкрж╢ржи">
                            тЛо
                        </button>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton{{ file.id }}">
                            <a class="dropdown-item" href="{{ url_for('view_file', file_id=file.id) }}">ржжрзЗржЦрзБржи</a>
                            <a class="dropdown-item" href="{{ url_for('download_file', file_id=file.id) }}">ржбрж╛ржЙржирж▓рзЛржб</a>
                            <div class="dropdown-divider"></div>
                            {# Share Button Form #}
                            <form method="post" action="{{ url_for('create_share_link', file_id=file.id) }}" class="dropdown-item p-0">
                                 <button type="submit" class="btn btn-link text-decoration-none text-body w-100 text-left pl-3">рж╢рзЗржпрж╝рж╛рж░</button>
                             </form>
                             {# Move Button Trigger #}
                            <button type="button" class="dropdown-item" data-toggle="modal" data-target="#moveModal{{ file.id }}">ржорзБржн</button>
                            <div class="dropdown-divider"></div>
                             {# Delete Button Form #}
                             <form method="post" action="{{ url_for('delete_file', file_id=file.id) }}" class="dropdown-item p-0" onsubmit="return confirm('ржЖржкржирж┐ ржХрж┐ ржирж┐рж╢рзНржЪрж┐рждржнрж╛ржмрзЗ ржПржЗ ржлрж╛ржЗрж▓ржЯрж┐ ржЯрзНрж░рзНржпрж╛рж╢рзЗ ржкрж╛ржарж╛рждрзЗ ржЪрж╛ржи?');">
                                <button type="submit" class="btn btn-link text-danger text-decoration-none w-100 text-left pl-3">ржбрж┐рж▓рж┐ржЯ (ржЯрзНрж░рзНржпрж╛рж╢)</button>
                            </form>
                        </div>
                    </div>
                </div>{# /file-actions #}
            </li>

             {# --- Move Modal for this file --- #}
             <div class="modal fade" id="moveModal{{ file.id }}" tabindex="-1" aria-labelledby="moveModalLabel{{ file.id }}" aria-hidden="true">
              <div class="modal-dialog modal-sm">
                <div class="modal-content">
                  <form method="post" action="{{ url_for('move_file', file_id=file.id) }}">
                    <div class="modal-header">
                      <h5 class="modal-title" id="moveModalLabel{{ file.id }}">ржлрж╛ржЗрж▓ ржорзБржн ржХрж░рзБржи</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    </div>
                    <div class="modal-body">
                      <p><small>ржлрж╛ржЗрж▓: {{ file.original_filename | truncate(40)}}</small></p>
                      <div class="form-group">
                          <label for="target_folder_id{{ file.id }}">ржХрзЛржерж╛рзЯ ржорзБржн ржХрж░ржмрзЗржи?</label>
                          <select name="target_folder_id" id="target_folder_id{{ file.id }}" class="form-control" required>
                              <option value="root">-- ржорзВрж▓ ржлрзЛрж▓рзНржбрж╛рж░ (рж░рзБржЯ) --</option>
                              {# 'folders' is the list of ALL folders passed from route #}
                              {# 'folder' is the current folder object #}
                              {% for f in folders %}
                                  {# Exclude the current folder #}
                                  {% if f.id != folder.id %}
                                       <option value="{{ f.id }}">{{ f.name }}</option>
                                  {% endif %}
                              {% endfor %}
                          </select>
                      </div>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">ржмрж╛рждрж┐рж▓</button>
                      <button type="submit" class="btn btn-primary btn-sm">ржорзБржн ржХрж░рзБржи</button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
            {# --- End Move Modal --- #}

            {% endfor %}
        </ul>{# /list-group #}
    {% else %}
        <p>ржПржЗ ржлрзЛрж▓рзНржбрж╛рж░рзЗ ржХрзЛржирзЛ ржлрж╛ржЗрж▓ ржирзЗржЗред</p>
    {% endif %}

{% endblock %}

