{% extends 'base.html' %}

{% block title %}ржжрзЗржЦрзБржи: {{ file.original_filename }}{% endblock %}

{% block content %}
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="mb-0 text-break">{{ file.original_filename }}</h2>
        {# Use javascript back or link to referrer/home #}
        <a href="javascript:history.back()" class="btn btn-sm btn-outline-secondary">&leftarrow; ржлрж┐рж░рзЗ ржпрж╛ржи</a>
    </div>
    <p class="text-muted">
        ржЖржкрж▓рзЛржб рж╣рзЯрзЗржЫрзЗ: {{ file.upload_time | datetimeformat }} <br>
        ржлрж╛ржЗрж▓рзЗрж░ ржкрзНрж░ржХрж╛рж░: {{ file.mime_type or 'Unknown' }}
    </p>
    <hr>

    {# Preview Section #}
    <div class="preview-container border rounded p-3 mb-3 text-center bg-light">
        {% if preview_type == 'image' %}
            <img src="{{ file_serve_url }}" alt="ржкрзНрж░рж┐ржнрж┐ржЙ {{ file.original_filename }}" class="img-fluid">
        {% elif preview_type == 'video' %}
            <video controls preload="metadata">
                <source src="{{ file_serve_url }}" type="{{ file.mime_type }}">
                ржЖржкржирж╛рж░ ржмрзНрж░рж╛ржЙржЬрж╛рж░ ржнрж┐ржбрж┐ржУ ржЯрзНржпрж╛ржЧ рж╕рж╛ржкрзЛрж░рзНржЯ ржХрж░рзЗ ржирж╛ред
            </video>
        {% elif preview_type == 'audio' %}
            <audio controls preload="metadata">
                <source src="{{ file_serve_url }}" type="{{ file.mime_type }}">
                ржЖржкржирж╛рж░ ржмрзНрж░рж╛ржЙржЬрж╛рж░ ржЕржбрж┐ржУ ржЯрзНржпрж╛ржЧ рж╕рж╛ржкрзЛрж░рзНржЯ ржХрж░рзЗ ржирж╛ред
            </audio>
        {% elif preview_type == 'pdf' %}
            <embed src="{{ file_serve_url }}" type="application/pdf" width="100%" height="70vh">
            <p class="mt-2">PDF ржкрзНрж░рж┐ржнрж┐ржЙ рж▓рзЛржб ржирж╛ рж╣рж▓рзЗ, ржЖржкржирж┐ ржлрж╛ржЗрж▓ржЯрж┐ <a href="{{ url_for('download_file', file_id=file.id) }}">ржбрж╛ржЙржирж▓рзЛржб ржХрж░рждрзЗ ржкрж╛рж░рзЗржи</a>ред</p>
        {% elif preview_type == 'text' %}
             {# Basic text preview attempt using iframe - might have security implications #}
             {# For production, consider server-side text reading or libraries #}
             <iframe src="{{ file_serve_url }}" width="100%" height="500px" style="border:1px solid #ccc;"></iframe>
             <p class="mt-2"><small>ржЯрзЗржХрзНрж╕ржЯ ржкрзНрж░рж┐ржнрж┐ржЙ ржжрзЗржЦрж╛ржирзЛ рж╣ржЪрзНржЫрзЗред ржмрзЬ ржлрж╛ржЗрж▓рзЗрж░ ржЬржирзНржп <a href="{{ url_for('download_file', file_id=file.id) }}">ржбрж╛ржЙржирж▓рзЛржб ржХрж░рзБржи</a>ред</small></p>
        {% else %}
            <p class="lead">ржжрзБржГржЦрж┐ржд, ржПржЗ ржлрж╛ржЗрж▓рзЗрж░ ржкрзНрж░ржХрж╛рж░рзЗрж░ ({{ file.mime_type or 'Unknown' }}) ржЬржирзНржп ржХрзЛржирзЛ ржкрзНрж░рж┐ржнрж┐ржЙ ржЙржкрж▓ржмрзНржз ржирзЗржЗред</p>
            <p>ржЖржкржирж┐ ржлрж╛ржЗрж▓ржЯрж┐ ржбрж╛ржЙржирж▓рзЛржб ржХрж░рзЗ ржжрзЗржЦрждрзЗ ржкрж╛рж░рзЗржиред</p>
        {% endif %}
    </div>

    {# Download Button #}
    <div class="mt-3 mb-3 text-center">
        <a href="{{ url_for('download_file', file_id=file.id) }}" class="btn btn-primary btn-lg">
            ЁЯУе ржбрж╛ржЙржирж▓рзЛржб ржХрж░рзБржи ({{ file.original_filename }})
        </a>
    </div>

{% endblock %}
